(()=>{"use strict";var e,t={110:(e,t,n)=>{n(260);const o={mode:"view",modeData:void 0,map:{mapArray:[],buildingTiles:[]},details:{date:new Date("01-01-2020"),dayDuration:.2},resources:{money:1e5,population:0,capacity:0},finances:{dayCosts:0,monthlyIncome:0}};window._globalState=o;const a=e=>{o.modeData=void 0,o.mode=e.mode,"build"!==e.mode&&"build-road"!==e.mode||(o.modeData=e.data),console.log({globalState:o})},i=(()=>{const e=new Phaser.Events.EventEmitter;return{on:(t,n)=>{e.on(t,n)},emit:(t,n)=>{e.emit(t,n)}}})();let s=0;const r="MainScene",l="UIScene",d="assets/tiles/green.png",c="assets/tiles/yellow.png",m="assets/tiles/selection.png",u="assets/tiles/roads.png",p=1e6,h=()=>{var e,t,n;const a=(null===(e=o.modeData)||void 0===e?void 0:e.buildable.details.price)||0;o.resources.money-=a,o.resources.capacity+=(null===(t=o.modeData)||void 0===t?void 0:t.buildable.details.capacity)||0,o.finances.dayCosts+=(null===(n=o.modeData)||void 0===n?void 0:n.buildable.details.dayCosts)||0},v=()=>{var e;return o.resources.money>((null===(e=o.modeData)||void 0===e?void 0:e.buildable.details.price)||0)},y=()=>{var e;return null===(e=o.modeData)||void 0===e?void 0:e.buildable},b={buildings:{house1:{id:"house-1",name:"House 1",description:"tbd",type:"residential",subTypes:["single"],sprite:{src:"assets/buildings/house1.png",frameWidth:64,frameHeight:64},details:{price:2e4,capacity:5,dayCosts:10,monthlyRent:1e3}},block1:{id:"block-1",name:"Block 1",description:"tbd",type:"residential",subTypes:["block"],sprite:{src:"assets/buildings/block1.png",frameWidth:64,frameHeight:80},details:{price:15e4,capacity:50,dayCosts:300,monthlyRent:500}}},roads:{road1:{sprite:"roads",name:"Single road 1",frame:0,details:{price:1e3,capacity:0,dayCosts:10,monthlyRent:0}}}},g=e=>({onPointerOver:()=>{var t;if("build-road"===o.mode&&void 0===e.tileContent||"road"===(null===(t=e.tileContent)||void 0===t?void 0:t.type)){e.selection=e.scene.add.image(e.x,e.y,m),e.selection.setOrigin(0,1),e.selection.setDepth(e.zIndex+p);const t=v()?1089552:15732752;e.selection.setTint(t)}},onPointerOut:()=>{var t,n;"build-road"===o.mode&&((null===(t=e.overlay)||void 0===t?void 0:t.destroy)&&(e.overlay.destroy(),e.overlay=void 0),(null===(n=e.selection)||void 0===n?void 0:n.destroy)&&(e.selection.destroy(),e.overlay=void 0))},onPointerDown:(t,n,a)=>{if("build-road"===o.mode&&v()){const t=(({verticalTriangle:e,horizontalTriangle:t})=>"up"===e?"right"===t?"ne":"nw":"right"===t?"se":"sw")({verticalTriangle:a<16?"up":"down",horizontalTriangle:n<32?"left":"right"});if(void 0===e.tileContent&&(e.tileContent={type:"road",roadPieces:[],buildable:b.roads.road1}),"road"===e.tileContent.type){e.tileContent.roadPieces.includes(t)||e.tileContent.roadPieces.push(t);const n=(e=>{const t=t=>t.length===e.length&&t.every((t=>e.includes(t)));return 0===e.length?0:t(["ne","sw"])?1:t(["se","nw"])?2:t(["ne"])?4:t(["se"])?5:t(["sw"])?6:t(["nw"])?7:t(["ne","nw"])?8:t(["ne","se"])?9:t(["se","sw"])?10:t(["sw","nw"])?11:t(["ne","se","nw"])?12:t(["ne","se","sw"])?13:t(["se","sw","nw"])?14:t(["ne","sw","nw"])?15:3})(e.tileContent.roadPieces);void 0===e.content?e.content=e.scene.add.image(e.x,e.y,u,n):e.content.setFrame(n),h(),e.content.setOrigin(0,1),e.content.setDepth(e.zIndex+5)}}}}),C=e=>({onPointerOver:()=>{"demolish"===o.mode&&(e.selection=e.scene.add.image(e.x,e.y,m),e.selection.setOrigin(0,1),e.selection.setDepth(e.zIndex+p),e.selection.setTint(15732752),void 0!==e.content&&(e.content.setTint(15732752),e.content.setAlpha(.5)))},onPointerOut:()=>{var t,n,a;"demolish"===o.mode&&((null===(t=e.overlay)||void 0===t?void 0:t.destroy)&&(e.overlay.destroy(),e.overlay=void 0),(null===(n=e.selection)||void 0===n?void 0:n.destroy)&&(e.selection.destroy(),e.overlay=void 0),(null===(a=e.content)||void 0===a?void 0:a.clearTint)&&(e.content.clearTint(),e.content.clearAlpha()))},onPointerDown:()=>{var t;if("demolish"===o.mode&&void 0!==e.content){null===(t=e.content)||void 0===t||t.destroy(),e.content=void 0;const n=o.map.buildingTiles.findIndex((t=>t===e));n>-1&&o.map.buildingTiles.splice(n,1)}}}),f=Phaser.Input.Events;class w extends Phaser.GameObjects.Image{constructor({scene:e,x:t,y:n,zIndex:a,row:i,column:s}){var r;super(e,t,n,d),this.scene=e,this.zIndex=a,this.x=t,this.y=n,this.row=i,this.column=s,this.originX=0,this.originY=1,this.updateDisplayOrigin(),this.setDepth(a+0),this.setInteractive({pixelPerfect:!0,alphaTolerance:1}),this.eventHandlers=[(r=this,{onPointerOver:()=>{if("build"===o.mode&&void 0===r.content){const e=!v();r.overlay=r.scene.add.image(r.x,r.y,y().id||"",0),r.overlay.setOrigin(0,1),r.overlay.setAlpha(.5),r.overlay.setDepth(r.zIndex+1000001),r.selection=r.scene.add.image(r.x,r.y,m),r.selection.setOrigin(0,1),r.selection.setDepth(r.zIndex+p),e&&r.overlay.setTint(15732752);const t=v()?1089552:15732752;r.selection.setTint(t)}},onPointerOut:()=>{var e,t;"build"===o.mode&&void 0===r.content&&((null===(e=r.overlay)||void 0===e?void 0:e.destroy)&&(r.overlay.destroy(),r.overlay=void 0),(null===(t=r.selection)||void 0===t?void 0:t.destroy)&&(r.selection.destroy(),r.overlay=void 0))},onPointerDown:()=>{var e,t;"build"===o.mode&&void 0===r.content&&v()&&(null===(e=r.overlay)||void 0===e||e.destroy(),r.overlay=void 0,r.tileContent={type:"building",buildabe:y(),population:0},r.content=r.scene.add.image(r.x,r.y,y().id||"",0),r.content.setOrigin(0,1),r.content.setDepth(r.zIndex+5),h(),o.map.buildingTiles.push(r),(null===(t=r.selection)||void 0===t?void 0:t.destroy)&&(r.selection.destroy(),r.overlay=void 0))}}),C(this),g(this)],this.on(f.POINTER_OVER,(()=>{this.eventHandlers.forEach((e=>e.onPointerOver()))})),this.on(f.POINTER_OUT,(()=>{this.eventHandlers.forEach((e=>e.onPointerOut()))})),this.on(f.POINTER_DOWN,((e,t,n)=>{this.eventHandlers.forEach((o=>o.onPointerDown(e,t,n)))})),this.scene.add.existing(this)}}class T extends Phaser.Scene{constructor(){super({key:r})}create(){this.keyBindings=(e=>{const t={};return{bindKeys:()=>{e.input.keyboard.on("keydown",(({key:e})=>{t[e]=!0})).on("keyup",(({key:e})=>{t[e]=!1})),e.input.on("wheel",((t,n,o,a,i,s)=>{a>0?e.cameras.main.zoom>.2&&(e.cameras.main.zoom-=.1):a<0&&e.cameras.main.zoom<2&&(e.cameras.main.zoom+=.1)}))},handleCameraMovement:()=>{t.w?e.cameras.main.scrollY-=10:t.s&&(e.cameras.main.scrollY+=10),t.a?e.cameras.main.scrollX-=10:t.d&&(e.cameras.main.scrollX+=10)}}})(this),this.createTiles(),this.keyBindings.bindKeys(),this.cameras.main.setName("world")}createTiles(){const e=this.cameras.main.width/2;for(let t=0;t<32;t++){const n=e-32*t,a=100+16*t;o.map.mapArray.push([]);for(let e=0;e<32;e++){const i=new w({scene:this,x:n+32*e,y:a+16*e,zIndex:10*(t+e+1),row:t,column:e});o.map.mapArray[t].push(i)}}}update(){this.keyBindings.handleCameraMovement()}}class x extends Phaser.Scene{constructor(){super({key:"PreloadScene"})}preload(){var e,t;this.load.image(d,d),this.load.image(c,c),this.load.image(m,m),e=this,t=b.buildings,Object.keys(t).forEach((n=>{const o=t[n];e.load.spritesheet(o.id,o.sprite.src,{frameWidth:o.sprite.frameWidth,frameHeight:o.sprite.frameHeight})})),this.load.spritesheet(u,u,{frameWidth:64,frameHeight:32})}create(){this.scene.start(r),this.scene.start(l)}}class E extends Phaser.GameObjects.Text{constructor(e){super(e,10,10,"",{color:"black",fontSize:"18px"}),e.add.existing(this),this.setOrigin(0)}update(){this.setText(`${Math.floor(this.scene.game.loop.actualFps)} fps`)}}const B=new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}),O=new Intl.DateTimeFormat("de-DE"),k=()=>{const e=document.querySelector(".bottomBarDateItem"),t=o.details.date;e.textContent=O.format(t);const n=document.querySelector(".bottomBarPopulationItem"),{capacity:a,population:i}=o.resources;n.textContent=`ðŸ§‘ ${i}/${a}`;const s=document.querySelector(".bottomBarMoneyItem"),r=o.resources.money,l=o.resources.money<0?"#f01010":"#10d010";s.textContent=B.format(r),s.style.color=l},P=()=>{const e=document.querySelector(".selectionBarContainer");e&&(e.innerHTML="")},D=e=>{P();const t=document.createElement("div");t.className="selectionBar";const n=(e=>{const t=document.createElement("div");t.className="selectionBarTitleBar";const n=document.createElement("div");n.className="selectionBarTitleBarTitle",n.innerText=e;const o=document.createElement("div");return o.className="selectionBarTitleBarCloseButton",o.innerText="X",o.addEventListener("click",(()=>{P(),a({mode:"view"})})),t.appendChild(n),t.appendChild(o),t})(e);if(t.appendChild(n),"build"===e){const e=(()=>{const e=Object.keys(b.buildings).map((e=>{const t=b.buildings[e],n=document.createElement("div");return n.className="selectionBarItem",n.innerHTML=`\n      <div class="selectionBarItemImage" style="background-image: url(${t.sprite})">\n      </div>\n      <div class="selectionBarItemName">\n        ${t.name}\n      </div>\n    `,n.addEventListener("click",(()=>{a({mode:"build",data:{buildable:t}})})),n})),t=document.createElement("div");return t.className="selectionBarContent",e.forEach((e=>{t.appendChild(e)})),t})();t.appendChild(e)}if("roads"===e){const e=(()=>{const e=document.createElement("div");e.className="selectionBarItem",e.innerHTML='\n      <div class="selectionBarItemName">\n        Road\n      </div>\n    ',e.addEventListener("click",(()=>{a({mode:"build-road",data:{buildable:b.roads.road1}})}));const t=document.createElement("div");return t.className="selectionBarContent",t.appendChild(e),t})();t.appendChild(e)}const o=document.querySelector(".selectionBarContainer");null==o||o.appendChild(t)},I=()=>{const e=document.createElement("div");return e.className="selectionBarContainer",{selectionBarContainer:e,openSelectionBar:D,closeSelectionBar:P}},N=({name:e,caption:t,callback:n})=>{const o=document.createElement("div");return o.className="leftMenuButton",o.innerText=t,o.addEventListener("click",n),o},S=e=>({create:()=>{(e=>{const{selectionBarContainer:t,openSelectionBar:n,closeSelectionBar:o}=I(),i=document.createElement("div");i.className="leftMenuWrapper";const s=document.createElement("div");s.className="leftMenu",s.appendChild(N({name:"roads",caption:"Roads",callback:()=>{o(),n("roads"),a({mode:"view"})}})),s.appendChild(N({name:"build",caption:"Build",callback:()=>{o(),n("build"),a({mode:"view"})}})),s.appendChild(N({name:"demolish",caption:"DMLSH",callback:()=>{o(),a({mode:"demolish"})}})),s.appendChild(N({name:"tbd",caption:"TBD",callback:()=>{o()}})),i.appendChild(s),i.appendChild(t);const r=e.add.dom(0,100,i);r.originX=0,r.originY=0})(e),(e=>{const t=document.createElement("div");t.className="bottomBar";const n=document.createElement("div");n.className="bottomBarWrapper",n.appendChild(t),(()=>{const e=document.createElement("div");e.className="bottomBarDateItem";const t=document.createElement("div");t.className="bottomBarPopulationItem";const n=document.createElement("div");return n.className="bottomBarMoneyItem",[e,t,n]})().forEach((e=>{t.appendChild(e)}));const o=e.add.dom(140,700,n);o.originX=0,o.originY=0,k(),setInterval(k,500)})(e)}});class z extends Phaser.Scene{constructor(){super({key:l}),this.ui=S(this)}create(){this.ui.create(),this.fpsText=new E(this)}update(){this.fpsText.update()}}const M=e=>o.map.buildingTiles.reduce(((t,n)=>{var o;return"building"===(null===(o=n.tileContent)||void 0===o?void 0:o.type)?t+e(n.tileContent):0}),0),H=()=>M((e=>e.buildabe.details.capacity)),R=()=>M((e=>e.population)),j={type:Phaser.AUTO,backgroundColor:"#303030",dom:{createContainer:!0},parent:"phaser-game",scale:{parent:"phaser-game",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:1280,height:720},scene:[x,T,z],physics:{default:"arcade",arcade:{debug:!1,gravity:{y:1e3}}}};window.addEventListener("load",(()=>{new Phaser.Game(j)})),(()=>{const e=()=>{setTimeout((()=>{e();try{(e=>{if(e-s>1e3*o.details.dayDuration){s=e;const t=o.details.date.getMonth();o.details.date.setDate(o.details.date.getDate()+1),i.emit("dayChanged",o.details.date),t!==o.details.date.getMonth()&&i.emit("monthChanged",o.details.date)}})((new Date).getTime())}catch(e){console.error(e)}}),100)};e()})(),i.on("dayChanged",(()=>{o.resources.money-=o.finances.dayCosts,R()<H()&&Math.random()<.5&&(()=>{var e;const t=o.map.buildingTiles.find((e=>{var t;return"building"===(null===(t=e.tileContent)||void 0===t?void 0:t.type)&&e.tileContent.population<e.tileContent.buildabe.details.capacity}));"building"===(null===(e=null==t?void 0:t.tileContent)||void 0===e?void 0:e.type)&&(t.tileContent.population+=1)})(),o.resources.capacity=H(),o.resources.population=R()})),i.on("monthChanged",(()=>{(()=>{const e=M((e=>e.population*e.buildabe.details.monthlyRent));o.resources.money+=e})()}))}},n={};function o(e){var a=n[e];if(void 0!==a)return a.exports;var i=n[e]={exports:{}};return t[e].call(i.exports,i,i.exports,o),i.exports}o.m=t,e=[],o.O=(t,n,a,i)=>{if(!n){var s=1/0;for(c=0;c<e.length;c++){for(var[n,a,i]=e[c],r=!0,l=0;l<n.length;l++)(!1&i||s>=i)&&Object.keys(o.O).every((e=>o.O[e](n[l])))?n.splice(l--,1):(r=!1,i<s&&(s=i));if(r){e.splice(c--,1);var d=a();void 0!==d&&(t=d)}}return t}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[n,a,i]},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};o.O.j=t=>0===e[t];var t=(t,n)=>{var a,i,[s,r,l]=n,d=0;if(s.some((t=>0!==e[t]))){for(a in r)o.o(r,a)&&(o.m[a]=r[a]);if(l)var c=l(o)}for(t&&t(n);d<s.length;d++)i=s[d],o.o(e,i)&&e[i]&&e[i][0](),e[s[d]]=0;return o.O(c)},n=self.webpackChunkphaser_project_template=self.webpackChunkphaser_project_template||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var a=o.O(void 0,[216],(()=>o(110)));a=o.O(a)})();