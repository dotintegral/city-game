(()=>{"use strict";var e,t={393:(e,t,n)=>{n(260);const o={mode:"view",modeData:void 0,map:{mapRows:16,mapColumns:16,mapArray:[],buildingTiles:[]},details:{date:new Date("01-01-2020"),dayDuration:.2},resources:{money:1e5,population:0,capacity:0},finances:{dayCosts:0,monthlyIncome:0}};window._globalState=o;const i=e=>{o.modeData=void 0,o.mode=e.mode,"build"!==e.mode&&"build-road"!==e.mode||(o.modeData=e.data)},a=(()=>{const e=new Phaser.Events.EventEmitter;return{on:(t,n)=>{e.on(t,n)},off:(t,n)=>{e.off(t,n)},emit:(t,n)=>{e.emit(t,n)}}})();let s=0;const r="MainScene",l="UIScene",d="assets/tiles/green.png",c="assets/tiles/yellow.png",m="assets/tiles/selection.png",u="assets/tiles/roads.png",p="assets/indicator.png",v=1e6,h=()=>{var e,t,n;const i=(null===(e=o.modeData)||void 0===e?void 0:e.buildable.details.price)||0;o.resources.money-=i,o.resources.capacity+=(null===(t=o.modeData)||void 0===t?void 0:t.buildable.details.capacity)||0,o.finances.dayCosts+=(null===(n=o.modeData)||void 0===n?void 0:n.buildable.details.dayCosts)||0},y=()=>{var e;return o.resources.money>((null===(e=o.modeData)||void 0===e?void 0:e.buildable.details.price)||0)},g=()=>{var e;return null===(e=o.modeData)||void 0===e?void 0:e.buildable},b=()=>o.modeData,f=e=>e/90,C=e=>{const t=()=>{var t;const n=(b().rotation+90)%360;b().rotation=n,null===(t=e.overlay)||void 0===t||t.setFrame(f(n))},n=()=>{var t,n,o;y()?null===(n=e.overlay)||void 0===n||n.clearTint():null===(t=e.overlay)||void 0===t||t.setTint(15732752);const i=y()?1089552:15732752;null===(o=e.selection)||void 0===o||o.setTint(i)};return{onPointerOver:()=>{"build"===o.mode&&void 0===e.content&&(e.overlay=e.scene.add.image(e.x,e.y,g().id||"",f(b().rotation)),e.overlay.setOrigin(0,1),e.overlay.setAlpha(.5),e.overlay.setDepth(e.zIndex+1000001),e.selection=e.scene.add.image(e.x,e.y,m),e.selection.setOrigin(0,1),e.selection.setDepth(e.zIndex+v),n(),a.on("dayChanged",n),e.scene.input.keyboard.on("keydown-R",t))},onPointerOut:()=>{var i,s;e.scene.input.keyboard.off("keydown-R",t),a.off("dayChanged",n),"build"===o.mode&&void 0===e.content&&((null===(i=e.overlay)||void 0===i?void 0:i.destroy)&&(e.overlay.destroy(),e.overlay=void 0),(null===(s=e.selection)||void 0===s?void 0:s.destroy)&&(e.selection.destroy(),e.overlay=void 0))},onPointerDown:()=>{var t,n;"build"===o.mode&&void 0===e.content&&y()&&(null===(t=e.overlay)||void 0===t||t.destroy(),e.overlay=void 0,e.tileContent={type:"building",buildabe:g(),population:0,level:0},e.content=e.scene.add.image(e.x,e.y,g().id||"",f(b().rotation)),e.content.setOrigin(0,1),e.content.setDepth(e.zIndex+5),h(),o.map.buildingTiles.push(e),(null===(n=e.selection)||void 0===n?void 0:n.destroy)&&(e.selection.destroy(),e.overlay=void 0))}}},w={buildings:{house1:{id:"house-1",name:"House 1",description:"tbd",type:"residential",subTypes:["single"],sprite:{src:"assets/buildings/house1.png",frameWidth:64,frameHeight:64},details:{price:2e4,capacity:5,dayCosts:50,monthlyRent:1e3},requirements:[{level:1,subTypes:["grocery"],proximity:5}]},block1:{id:"block-1",name:"Block 1",description:"tbd",type:"residential",subTypes:["block"],sprite:{src:"assets/buildings/block1.png",frameWidth:64,frameHeight:80},details:{price:15e4,capacity:50,dayCosts:300,monthlyRent:500},requirements:[]},shop1:{id:"shop-1",name:"Grocery Shop",description:"tbd",type:"commercial",subTypes:["grocery"],sprite:{src:"assets/buildings/shop1.png",frameWidth:64,frameHeight:64},details:{price:2e4,capacity:0,dayCosts:50,monthlyRent:1e3},requirements:[]}},roads:{road1:{sprite:"roads",name:"Single road 1",frame:0,details:{price:1e3,capacity:0,dayCosts:10,monthlyRent:0}}}},x=e=>({onPointerOver:()=>{var t;if("build-road"===o.mode&&void 0===e.tileContent||"road"===(null===(t=e.tileContent)||void 0===t?void 0:t.type)){e.selection=e.scene.add.image(e.x,e.y,m),e.selection.setOrigin(0,1),e.selection.setDepth(e.zIndex+v);const t=y()?1089552:15732752;e.selection.setTint(t)}},onPointerOut:()=>{var t,n;"build-road"===o.mode&&((null===(t=e.overlay)||void 0===t?void 0:t.destroy)&&(e.overlay.destroy(),e.overlay=void 0),(null===(n=e.selection)||void 0===n?void 0:n.destroy)&&(e.selection.destroy(),e.overlay=void 0))},onPointerDown:(t,n,i)=>{if("build-road"===o.mode&&y()){const t=(({verticalTriangle:e,horizontalTriangle:t})=>"up"===e?"right"===t?"ne":"nw":"right"===t?"se":"sw")({verticalTriangle:i<16?"up":"down",horizontalTriangle:n<32?"left":"right"});if(void 0===e.tileContent&&(e.tileContent={type:"road",roadPieces:[],buildable:w.roads.road1}),"road"===e.tileContent.type){e.tileContent.roadPieces.includes(t)||e.tileContent.roadPieces.push(t);const n=(e=>{const t=t=>t.length===e.length&&t.every((t=>e.includes(t)));return 0===e.length?0:t(["ne","sw"])?1:t(["se","nw"])?2:t(["ne"])?4:t(["se"])?5:t(["sw"])?6:t(["nw"])?7:t(["ne","nw"])?8:t(["ne","se"])?9:t(["se","sw"])?10:t(["sw","nw"])?11:t(["ne","se","nw"])?12:t(["ne","se","sw"])?13:t(["se","sw","nw"])?14:t(["ne","sw","nw"])?15:3})(e.tileContent.roadPieces);void 0===e.content?e.content=e.scene.add.image(e.x,e.y,u,n):e.content.setFrame(n),h(),e.content.setOrigin(0,1),e.content.setDepth(e.zIndex+5)}}}}),T=Phaser.Input.Events;class k extends Phaser.GameObjects.Image{constructor({scene:e,x:t,y:n,zIndex:i,row:a,column:s}){var r;super(e,t,n,d),this.scene=e,this.zIndex=i,this.x=t,this.y=n,this.row=a,this.column=s,this.originX=0,this.originY=1,this.updateDisplayOrigin(),this.setDepth(i+0),this.setInteractive({pixelPerfect:!0,alphaTolerance:1}),this.eventHandlers=[C(this),(r=this,{onPointerOver:()=>{"demolish"===o.mode&&(r.selection=r.scene.add.image(r.x,r.y,m),r.selection.setOrigin(0,1),r.selection.setDepth(r.zIndex+v),r.selection.setTint(15732752),void 0!==r.content&&(r.content.setTint(15732752),r.content.setAlpha(.5)))},onPointerOut:()=>{var e,t,n;"demolish"===o.mode&&((null===(e=r.overlay)||void 0===e?void 0:e.destroy)&&(r.overlay.destroy(),r.overlay=void 0),(null===(t=r.selection)||void 0===t?void 0:t.destroy)&&(r.selection.destroy(),r.overlay=void 0),(null===(n=r.content)||void 0===n?void 0:n.clearTint)&&(r.content.clearTint(),r.content.clearAlpha()))},onPointerDown:()=>{var e;if("demolish"===o.mode&&void 0!==r.content){null===(e=r.content)||void 0===e||e.destroy(),r.content=void 0;const t=o.map.buildingTiles.findIndex((e=>e===r));t>-1&&o.map.buildingTiles.splice(t,1)}}}),x(this)],this.levelHandler=(e=>{let t=!1;const n=o=>{var i;if(t){const t=32*(.5+.2*(1-Math.cos(o)));null===(i=e.indicator)||void 0===i||i.setY(e.y-t),e.scene.time.delayedCall(30,n,[o+.1])}};return{checkLevel:()=>{var o,i;"building"===(null===(o=e.tileContent)||void 0===o?void 0:o.type)&&(e.tileContent.level<1?e.indicator||(e.indicator=e.scene.add.image(e.x+32,e.y-16,p),e.indicator.setOrigin(.5,1),e.indicator.setDepth(e.zIndex+1000002),t=!0,e.scene.time.delayedCall(30,n,[0])):(t=!1,null===(i=e.indicator)||void 0===i||i.destroy(),e.indicator=void 0))}}})(this),this.on(T.POINTER_OVER,(()=>{this.eventHandlers.forEach((e=>e.onPointerOver()))})),this.on(T.POINTER_OUT,(()=>{this.eventHandlers.forEach((e=>e.onPointerOut()))})),this.on(T.POINTER_DOWN,((e,t,n)=>{this.eventHandlers.forEach((o=>o.onPointerDown(e,t,n)))})),this.scene.add.existing(this)}checkState(){this.levelHandler.checkLevel()}}class E extends Phaser.Scene{constructor(){super({key:r})}create(){this.keyBindings=(e=>{const t={};return{bindKeys:()=>{e.input.keyboard.on("keydown",(({key:e})=>{t[e]=!0})).on("keyup",(({key:e})=>{t[e]=!1})),e.input.on("wheel",((t,n,o,i,a,s)=>{i>0?e.cameras.main.zoom>.2&&(e.cameras.main.zoom-=.1):i<0&&e.cameras.main.zoom<2&&(e.cameras.main.zoom+=.1)}))},handleCameraMovement:()=>{t.w?e.cameras.main.scrollY-=10:t.s&&(e.cameras.main.scrollY+=10),t.a?e.cameras.main.scrollX-=10:t.d&&(e.cameras.main.scrollX+=10)}}})(this),this.createTiles(),this.keyBindings.bindKeys(),this.cameras.main.setName("world")}createTiles(){const e=this.cameras.main.width/2;for(let t=0;t<o.map.mapRows;t++){const n=e-64*t/2,i=100+32*t/2;o.map.mapArray.push([]);for(let e=0;e<o.map.mapColumns;e++){const a=new k({scene:this,x:n+32*e,y:i+16*e,zIndex:10*(t+e+1),row:t,column:e});o.map.mapArray[t].push(a)}}}update(){this.keyBindings.handleCameraMovement()}}class B extends Phaser.Scene{constructor(){super({key:"PreloadScene"})}preload(){var e,t;this.load.image(d,d),this.load.image(c,c),this.load.image(m,m),this.load.image(p,p),e=this,t=w.buildings,Object.keys(t).forEach((n=>{const o=t[n];e.load.spritesheet(o.id,o.sprite.src,{frameWidth:o.sprite.frameWidth,frameHeight:o.sprite.frameHeight})})),this.load.spritesheet(u,u,{frameWidth:64,frameHeight:32})}create(){this.scene.start(r),this.scene.start(l)}}class I extends Phaser.GameObjects.Text{constructor(e){super(e,10,10,"",{color:"black",fontSize:"18px"}),e.add.existing(this),this.setOrigin(0)}update(){this.setText(`${Math.floor(this.scene.game.loop.actualFps)} fps`)}}const O=new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}),D=new Intl.DateTimeFormat("de-DE"),P=()=>{const e=document.querySelector(".bottomBarDateItem"),t=o.details.date;e.textContent=D.format(t);const n=document.querySelector(".bottomBarPopulationItem"),{capacity:i,population:a}=o.resources;n.textContent=`ðŸ§‘ ${a}/${i}`;const s=document.querySelector(".bottomBarMoneyItem"),r=o.resources.money,l=o.resources.money<0?"#f01010":"#10d010";s.textContent=O.format(r),s.style.color=l},N=()=>{const e=document.querySelector(".selectionBarContainer");e&&(e.innerHTML="")},S=e=>{N();const t=document.createElement("div");t.className="selectionBar";const n=(e=>{const t=document.createElement("div");t.className="selectionBarTitleBar";const n=document.createElement("div");n.className="selectionBarTitleBarTitle",n.innerText=e;const o=document.createElement("div");return o.className="selectionBarTitleBarCloseButton",o.innerText="X",o.addEventListener("click",(()=>{N(),i({mode:"view"})})),t.appendChild(n),t.appendChild(o),t})(e);if(t.appendChild(n),"build"===e){const e=(()=>{const e=Object.keys(w.buildings).map((e=>{const t=w.buildings[e],n=document.createElement("div"),o=[`background-image: url(${t.sprite.src})`,`width: ${t.sprite.frameWidth}px`,`height: ${t.sprite.frameHeight}px`].join("; ");return n.className="selectionBarItem",n.innerHTML=`\n      <div class="selectionBarItemImage">\n        <div className="selectionBarItemImageViewport" style="${o}">\n        </div>\n      </div>\n      <div class="selectionBarItemName">\n        ${t.name}\n      </div>\n    `,n.addEventListener("click",(()=>{i({mode:"build",data:{buildable:t,rotation:0}})})),n})),t=document.createElement("div");return t.className="selectionBarContent",e.forEach((e=>{t.appendChild(e)})),t})();t.appendChild(e)}if("roads"===e){const e=(()=>{const e=document.createElement("div"),t=[`background-image: url(${u})`,"width: 64px","height: 32px","background-position: -128px 0px"].join("; ");e.className="selectionBarItem",e.innerHTML=`\n      <div class="selectionBarItemImage">\n        <div className="selectionBarItemImageViewport" style="${t}">\n        </div>\n      </div>\n      <div class="selectionBarItemName">\n       Road 1\n      </div>\n    `,e.addEventListener("click",(()=>{i({mode:"build-road",data:{buildable:w.roads.road1}})}));const n=document.createElement("div");return n.className="selectionBarContent",n.appendChild(e),n})();t.appendChild(e)}const o=document.querySelector(".selectionBarContainer");null==o||o.appendChild(t)},M=()=>{const e=document.createElement("div");return e.className="selectionBarContainer",{selectionBarContainer:e,openSelectionBar:S,closeSelectionBar:N}},H=({name:e,caption:t,callback:n})=>{const o=document.createElement("div");return o.className="leftMenuButton",o.innerText=t,o.addEventListener("click",n),o},R=e=>({create:()=>{(e=>{const{selectionBarContainer:t,openSelectionBar:n,closeSelectionBar:o}=M(),a=document.createElement("div");a.className="leftMenuWrapper";const s=document.createElement("div");s.className="leftMenu",s.appendChild(H({name:"roads",caption:"Roads",callback:()=>{o(),n("roads"),i({mode:"view"})}})),s.appendChild(H({name:"build",caption:"Build",callback:()=>{o(),n("build"),i({mode:"view"})}})),s.appendChild(H({name:"demolish",caption:"DMLSH",callback:()=>{o(),i({mode:"demolish"})}})),s.appendChild(H({name:"tbd",caption:"TBD",callback:()=>{o()}})),a.appendChild(s),a.appendChild(t);const r=e.add.dom(0,100,a);r.originX=0,r.originY=0})(e),(e=>{const t=document.createElement("div");t.className="bottomBar";const n=document.createElement("div");n.className="bottomBarWrapper",n.appendChild(t),(()=>{const e=document.createElement("div");e.className="bottomBarDateItem";const t=document.createElement("div");t.className="bottomBarPopulationItem";const n=document.createElement("div");return n.className="bottomBarMoneyItem",[e,t,n]})().forEach((e=>{t.appendChild(e)}));const o=e.add.dom(140,700,n);o.originX=0,o.originY=0,P(),setInterval(P,500)})(e)}});class z extends Phaser.Scene{constructor(){super({key:l}),this.ui=R(this)}create(){this.ui.create(),this.fpsText=new I(this)}update(){this.fpsText.update()}}const j=e=>{const t=e.tileContent,n=t.buildabe.requirements,i={0:!0,1:void 0,2:void 0,3:void 0,4:void 0,5:void 0,6:void 0,7:void 0,8:void 0,9:void 0,10:void 0};n.forEach((t=>{const n=t.level,a=((e,t)=>{const{proximity:n,subTypes:i}=e,a=((e,t)=>{const{row:n,column:i}=e,a=[],s=Math.max(n-t,0),r=Math.max(i-t,0),l=Math.min(n+t,o.map.mapRows-1),d=Math.min(i+t,o.map.mapColumns-1);for(let e=s;e<=l;e++)for(let t=r;t<=d;t++)if(e!==n||t!==i){const n=o.map.mapArray[e][t];void 0!==n.tileContent&&a.push(n)}return a})(t,n),s=a.map((e=>e.tileContent)).filter((e=>"building"===(null==e?void 0:e.type))),r=i[0];return s.some((e=>e.buildabe.subTypes.includes(r)))})(t,e);void 0===i[n]?i[n]=a:i[n]=i[n]&&a}));const a=(e=>{const t=Object.entries(e).map((([e,t])=>t?parseInt(e):0));return Math.max(...t)})(i);t.level=a,e.checkState()},L=e=>o.map.buildingTiles.reduce(((t,n)=>{var o;return"building"===(null===(o=n.tileContent)||void 0===o?void 0:o.type)?t+e(n.tileContent):0}),0),W=()=>L((e=>e.buildabe.details.capacity)),$=()=>L((e=>e.population)),q={0:0,1:1,2:1.2,3:1.4,4:1.6,5:1.8},_={type:Phaser.AUTO,backgroundColor:"#303030",dom:{createContainer:!0},parent:"phaser-game",scale:{parent:"phaser-game",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:1280,height:720},scene:[B,E,z],physics:{default:"arcade",arcade:{debug:!1,gravity:{y:1e3}}}};window.addEventListener("load",(()=>{new Phaser.Game(_)})),(()=>{const e=()=>{setTimeout((()=>{e();try{(e=>{if(e-s>1e3*o.details.dayDuration){s=e;const t=o.details.date.getMonth();o.details.date.setDate(o.details.date.getDate()+1),a.emit("dayChanged",o.details.date),t!==o.details.date.getMonth()&&a.emit("monthChanged",o.details.date)}})((new Date).getTime())}catch(e){console.error(e)}}),100)};e()})(),a.on("dayChanged",(()=>{o.resources.money-=o.finances.dayCosts,$()<W()&&Math.random()<.5&&(()=>{var e;const t=o.map.buildingTiles.find((e=>{var t;return"building"===(null===(t=e.tileContent)||void 0===t?void 0:t.type)&&e.tileContent.population<e.tileContent.buildabe.details.capacity}));"building"===(null===(e=null==t?void 0:t.tileContent)||void 0===e?void 0:e.type)&&(t.tileContent.population+=1)})(),o.resources.capacity=W(),o.resources.population=$()})),a.on("monthChanged",(()=>{(()=>{const{buildingTiles:e}=o.map;e.forEach(j)})(),(()=>{const e=L((e=>e.population*(e=>{const{level:t,buildabe:{details:{monthlyRent:n}}}=e;return(q[t]||0)*n})(e)));o.resources.money+=e})()}))}},n={};function o(e){var i=n[e];if(void 0!==i)return i.exports;var a=n[e]={exports:{}};return t[e].call(a.exports,a,a.exports,o),a.exports}o.m=t,e=[],o.O=(t,n,i,a)=>{if(!n){var s=1/0;for(c=0;c<e.length;c++){for(var[n,i,a]=e[c],r=!0,l=0;l<n.length;l++)(!1&a||s>=a)&&Object.keys(o.O).every((e=>o.O[e](n[l])))?n.splice(l--,1):(r=!1,a<s&&(s=a));if(r){e.splice(c--,1);var d=i();void 0!==d&&(t=d)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[n,i,a]},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};o.O.j=t=>0===e[t];var t=(t,n)=>{var i,a,[s,r,l]=n,d=0;if(s.some((t=>0!==e[t]))){for(i in r)o.o(r,i)&&(o.m[i]=r[i]);if(l)var c=l(o)}for(t&&t(n);d<s.length;d++)a=s[d],o.o(e,a)&&e[a]&&e[a][0](),e[s[d]]=0;return o.O(c)},n=self.webpackChunkphaser_project_template=self.webpackChunkphaser_project_template||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var i=o.O(void 0,[216],(()=>o(393)));i=o.O(i)})();